<Window x:Class="StudentClinicMIS.Views.DoctorMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:StudentClinicMIS.ViewModels"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:converters="clr-namespace:StudentClinicMIS.Converters"
        mc:Ignorable="d"
        Title="{Binding CurrentDoctor.Employee.LastName, StringFormat='Доктор: {0}'}" 
        Height="700" Width="1100"
        WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI"
        Background="#FFF5F5F5">

    <Window.Resources>
        <converters:TimeOnlyConverter x:Key="TimeOnlyConverter"/>
        <converters:DateOnlyConverter x:Key="DateOnlyConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>

        <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="Background" Value="White"/>
        </Style>

        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Background" Value="#FF3F51B5"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Background" Value="#FFEEEEEE"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFDDDDDD"/>
        </Style>

        <Style TargetType="ListView">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="White"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#FF3F51B5" Padding="10" CornerRadius="3">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="{Binding CurrentDoctor.FullName}" 
                           FontSize="20" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="{Binding CurrentDoctor.Specialization.Name, StringFormat=' - {0}'}" 
                           FontSize="20" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Основное содержимое -->
        <Grid Grid.Row="1" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Левая часть - Приемы и расписание -->
            <TabControl Grid.Column="0" Margin="0,0,5,0">
                <TabItem Header="Сегодняшние приёмы">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Мой график" FontSize="16" FontWeight="Bold" Margin="5"/>
                        <ListView ItemsSource="{Binding TodayAppointments}" 
                                  SelectedItem="{Binding SelectedAppointment}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Время" Width="80" 
                                                  DisplayMemberBinding="{Binding StartTime, Converter={StaticResource TimeOnlyConverter}}"/>
                                    <GridViewColumn Header="Пациент" Width="200" 
                                                  DisplayMemberBinding="{Binding Patient.FullName}"/>
                                    <GridViewColumn Header="Жалобы" Width="200" 
                                                  DisplayMemberBinding="{Binding Purpose}"/>
                                    <GridViewColumn Header="Статус" Width="100" 
                                                  DisplayMemberBinding="{Binding Status}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </DockPanel>
                </TabItem>

                <TabItem Header="Мой график">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Мой график" FontSize="16" FontWeight="Bold" Margin="5"/>
                        <ListView ItemsSource="{Binding DoctorSchedules}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="День" Width="120" 
                                                  DisplayMemberBinding="{Binding DayOfWeek}"/>
                                    <GridViewColumn Header="Начало" Width="80" 
                                                  DisplayMemberBinding="{Binding StartTime, Converter={StaticResource TimeOnlyConverter}}"/>
                                    <GridViewColumn Header="Конец" Width="80" 
                                                  DisplayMemberBinding="{Binding EndTime, Converter={StaticResource TimeOnlyConverter}}"/>
                                    <GridViewColumn Header="Кабинет" Width="100" 
                                                  DisplayMemberBinding="{Binding Room.Number}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </DockPanel>
                </TabItem>
            </TabControl>

            <!-- Разделитель -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" 
                          VerticalAlignment="Stretch" Background="#FFDDDDDD"/>

            <!-- Правая часть - Информация о пациенте -->
            <TabControl Grid.Column="2" Margin="5,0,0,0" 
                        Visibility="{Binding IsPatientSelected, Converter={StaticResource BoolToVisibility}}">
                <TabItem Header="Карточка пациента">
                    <ScrollViewer>
                        <StackPanel Margin="10">
                            <TextBlock Text="Карточка пациента" FontSize="16" FontWeight="Bold"/>

                            <TextBlock Text="{Binding SelectedAppointment.Patient.FullName}" 
                                       Margin="5,10,5,5" FontWeight="Bold"/>

                            <TextBlock Text="Возраст:" Margin="5,10,5,0"/>
                            <TextBlock Text="{Binding SelectedAppointment.Patient.FormattedBirthDate}" 
                                       Margin="5,0,5,5"/>

                            <TextBlock Text="Факультет:" Margin="5,10,5,0"/>
                            <TextBlock Text="{Binding SelectedAppointment.Patient.FacultyName}" 
                                       Margin="5,0,5,5"/>

                            <TextBlock Text="Студенческий билет:" Margin="5,10,5,0"/>
                            <TextBlock Text="{Binding SelectedAppointment.Patient.GroupName}" 
                                       Margin="5,0,5,5"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <TabItem Header="История приёмов">
                    <ScrollViewer>
                        <StackPanel Margin="10">
                            <TextBlock Text="История приёмов" FontSize="16" FontWeight="Bold"/>

                            <ItemsControl ItemsSource="{Binding SelectedAppointment.Patient.MedicalRecords}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="#FFDDDDDD" BorderThickness="0,0,0,1" Margin="0,5">
                                            <StackPanel>
                                                <TextBlock Text="{Binding RecordDate, StringFormat='Дата: {0:dd MMM yyyy}'}" 
                                                           FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Diagnosis, StringFormat='Диагноз: {0}'}"/>
                                                <TextBlock Text="{Binding Treatment, StringFormat='Рекомендации: {0}'}"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <TabItem Header="Новая запись">
                    <ScrollViewer>
                        <StackPanel Margin="10">
                            <TextBlock Text="Новая запись" FontSize="16" FontWeight="Bold"/>

                            <DatePicker SelectedDate="{Binding NewRecordDate}" 
                                        Margin="5,10" 
                                        materialDesign:HintAssist.Hint="Дата записи"/>

                            <TextBox Text="{Binding NewDiagnosis}" 
                                     Margin="5" 
                                     materialDesign:HintAssist.Hint="Диагноз"
                                     AcceptsReturn="True" 
                                     TextWrapping="Wrap" 
                                     MinHeight="60"/>

                            <TextBox Text="{Binding NewRecommendations}" 
                                     Margin="5" 
                                     materialDesign:HintAssist.Hint="Рекомендации"
                                     AcceptsReturn="True" 
                                     TextWrapping="Wrap" 
                                     MinHeight="100"/>

                            <Button Content="Сохранить в карту" 
                                    Command="{Binding SaveRecordCommand}" 
                                    HorizontalAlignment="Right" 
                                    Margin="5,10" 
                                    Width="150"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Window>